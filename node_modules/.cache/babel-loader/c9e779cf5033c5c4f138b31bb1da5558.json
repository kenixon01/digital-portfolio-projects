{"ast":null,"code":"'use strict';\n\nconst GetMore = require('../connection/commands').GetMore;\nconst retrieveBSON = require('../connection/utils').retrieveBSON;\nconst MongoError = require('../error').MongoError;\nconst MongoNetworkError = require('../error').MongoNetworkError;\nconst BSON = retrieveBSON();\nconst Long = BSON.Long;\nconst collectionNamespace = require('./shared').collectionNamespace;\nconst maxWireVersion = require('../utils').maxWireVersion;\nconst applyCommonQueryOptions = require('./shared').applyCommonQueryOptions;\nconst command = require('./command');\nfunction getMore(server, ns, cursorState, batchSize, options, callback) {\n  options = options || {};\n  const wireVersion = maxWireVersion(server);\n  function queryCallback(err, result) {\n    if (err) return callback(err);\n    const response = result.message;\n\n    // If we have a timed out query or a cursor that was killed\n    if (response.cursorNotFound) {\n      return callback(new MongoNetworkError('cursor killed or timed out'), null);\n    }\n    if (wireVersion < 4) {\n      const cursorId = typeof response.cursorId === 'number' ? Long.fromNumber(response.cursorId) : response.cursorId;\n      cursorState.documents = response.documents;\n      cursorState.cursorId = cursorId;\n      callback(null, null, response.connection);\n      return;\n    }\n\n    // We have an error detected\n    if (response.documents[0].ok === 0) {\n      return callback(new MongoError(response.documents[0]));\n    }\n\n    // Ensure we have a Long valid cursor id\n    const cursorId = typeof response.documents[0].cursor.id === 'number' ? Long.fromNumber(response.documents[0].cursor.id) : response.documents[0].cursor.id;\n    cursorState.documents = response.documents[0].cursor.nextBatch;\n    cursorState.cursorId = cursorId;\n    callback(null, response.documents[0], response.connection);\n  }\n  if (wireVersion < 4) {\n    const bson = server.s.bson;\n    const getMoreOp = new GetMore(bson, ns, cursorState.cursorId, {\n      numberToReturn: batchSize\n    });\n    const queryOptions = applyCommonQueryOptions({}, cursorState);\n    server.s.pool.write(getMoreOp, queryOptions, queryCallback);\n    return;\n  }\n  const cursorId = cursorState.cursorId instanceof Long ? cursorState.cursorId : Long.fromNumber(cursorState.cursorId);\n  const getMoreCmd = {\n    getMore: cursorId,\n    collection: collectionNamespace(ns),\n    batchSize: Math.abs(batchSize)\n  };\n  if (cursorState.cmd.tailable && typeof cursorState.cmd.maxAwaitTimeMS === 'number') {\n    getMoreCmd.maxTimeMS = cursorState.cmd.maxAwaitTimeMS;\n  }\n  const commandOptions = Object.assign({\n    returnFieldSelector: null,\n    documentsReturnedIn: 'nextBatch'\n  }, options);\n  if (cursorState.session) {\n    commandOptions.session = cursorState.session;\n  }\n  command(server, ns, getMoreCmd, commandOptions, queryCallback);\n}\nmodule.exports = getMore;","map":{"version":3,"names":["GetMore","require","retrieveBSON","MongoError","MongoNetworkError","BSON","Long","collectionNamespace","maxWireVersion","applyCommonQueryOptions","command","getMore","server","ns","cursorState","batchSize","options","callback","wireVersion","queryCallback","err","result","response","message","cursorNotFound","cursorId","fromNumber","documents","connection","ok","cursor","id","nextBatch","bson","s","getMoreOp","numberToReturn","queryOptions","pool","write","getMoreCmd","collection","Math","abs","cmd","tailable","maxAwaitTimeMS","maxTimeMS","commandOptions","Object","assign","returnFieldSelector","documentsReturnedIn","session","module","exports"],"sources":["C:/Users/minix/Documents/GitHub/digital-portfolio-projects/digital-portfolio-projects/node_modules/mongodb/lib/core/wireprotocol/get_more.js"],"sourcesContent":["'use strict';\n\nconst GetMore = require('../connection/commands').GetMore;\nconst retrieveBSON = require('../connection/utils').retrieveBSON;\nconst MongoError = require('../error').MongoError;\nconst MongoNetworkError = require('../error').MongoNetworkError;\nconst BSON = retrieveBSON();\nconst Long = BSON.Long;\nconst collectionNamespace = require('./shared').collectionNamespace;\nconst maxWireVersion = require('../utils').maxWireVersion;\nconst applyCommonQueryOptions = require('./shared').applyCommonQueryOptions;\nconst command = require('./command');\n\nfunction getMore(server, ns, cursorState, batchSize, options, callback) {\n  options = options || {};\n\n  const wireVersion = maxWireVersion(server);\n  function queryCallback(err, result) {\n    if (err) return callback(err);\n    const response = result.message;\n\n    // If we have a timed out query or a cursor that was killed\n    if (response.cursorNotFound) {\n      return callback(new MongoNetworkError('cursor killed or timed out'), null);\n    }\n\n    if (wireVersion < 4) {\n      const cursorId =\n        typeof response.cursorId === 'number'\n          ? Long.fromNumber(response.cursorId)\n          : response.cursorId;\n\n      cursorState.documents = response.documents;\n      cursorState.cursorId = cursorId;\n\n      callback(null, null, response.connection);\n      return;\n    }\n\n    // We have an error detected\n    if (response.documents[0].ok === 0) {\n      return callback(new MongoError(response.documents[0]));\n    }\n\n    // Ensure we have a Long valid cursor id\n    const cursorId =\n      typeof response.documents[0].cursor.id === 'number'\n        ? Long.fromNumber(response.documents[0].cursor.id)\n        : response.documents[0].cursor.id;\n\n    cursorState.documents = response.documents[0].cursor.nextBatch;\n    cursorState.cursorId = cursorId;\n\n    callback(null, response.documents[0], response.connection);\n  }\n\n  if (wireVersion < 4) {\n    const bson = server.s.bson;\n    const getMoreOp = new GetMore(bson, ns, cursorState.cursorId, { numberToReturn: batchSize });\n    const queryOptions = applyCommonQueryOptions({}, cursorState);\n    server.s.pool.write(getMoreOp, queryOptions, queryCallback);\n    return;\n  }\n\n  const cursorId =\n    cursorState.cursorId instanceof Long\n      ? cursorState.cursorId\n      : Long.fromNumber(cursorState.cursorId);\n\n  const getMoreCmd = {\n    getMore: cursorId,\n    collection: collectionNamespace(ns),\n    batchSize: Math.abs(batchSize)\n  };\n\n  if (cursorState.cmd.tailable && typeof cursorState.cmd.maxAwaitTimeMS === 'number') {\n    getMoreCmd.maxTimeMS = cursorState.cmd.maxAwaitTimeMS;\n  }\n\n  const commandOptions = Object.assign(\n    {\n      returnFieldSelector: null,\n      documentsReturnedIn: 'nextBatch'\n    },\n    options\n  );\n\n  if (cursorState.session) {\n    commandOptions.session = cursorState.session;\n  }\n\n  command(server, ns, getMoreCmd, commandOptions, queryCallback);\n}\n\nmodule.exports = getMore;\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,OAAO,GAAGC,OAAO,CAAC,wBAAwB,CAAC,CAACD,OAAO;AACzD,MAAME,YAAY,GAAGD,OAAO,CAAC,qBAAqB,CAAC,CAACC,YAAY;AAChE,MAAMC,UAAU,GAAGF,OAAO,CAAC,UAAU,CAAC,CAACE,UAAU;AACjD,MAAMC,iBAAiB,GAAGH,OAAO,CAAC,UAAU,CAAC,CAACG,iBAAiB;AAC/D,MAAMC,IAAI,GAAGH,YAAY,EAAE;AAC3B,MAAMI,IAAI,GAAGD,IAAI,CAACC,IAAI;AACtB,MAAMC,mBAAmB,GAAGN,OAAO,CAAC,UAAU,CAAC,CAACM,mBAAmB;AACnE,MAAMC,cAAc,GAAGP,OAAO,CAAC,UAAU,CAAC,CAACO,cAAc;AACzD,MAAMC,uBAAuB,GAAGR,OAAO,CAAC,UAAU,CAAC,CAACQ,uBAAuB;AAC3E,MAAMC,OAAO,GAAGT,OAAO,CAAC,WAAW,CAAC;AAEpC,SAASU,OAAO,CAACC,MAAM,EAAEC,EAAE,EAAEC,WAAW,EAAEC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,EAAE;EACtED,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;EAEvB,MAAME,WAAW,GAAGV,cAAc,CAACI,MAAM,CAAC;EAC1C,SAASO,aAAa,CAACC,GAAG,EAAEC,MAAM,EAAE;IAClC,IAAID,GAAG,EAAE,OAAOH,QAAQ,CAACG,GAAG,CAAC;IAC7B,MAAME,QAAQ,GAAGD,MAAM,CAACE,OAAO;;IAE/B;IACA,IAAID,QAAQ,CAACE,cAAc,EAAE;MAC3B,OAAOP,QAAQ,CAAC,IAAIb,iBAAiB,CAAC,4BAA4B,CAAC,EAAE,IAAI,CAAC;IAC5E;IAEA,IAAIc,WAAW,GAAG,CAAC,EAAE;MACnB,MAAMO,QAAQ,GACZ,OAAOH,QAAQ,CAACG,QAAQ,KAAK,QAAQ,GACjCnB,IAAI,CAACoB,UAAU,CAACJ,QAAQ,CAACG,QAAQ,CAAC,GAClCH,QAAQ,CAACG,QAAQ;MAEvBX,WAAW,CAACa,SAAS,GAAGL,QAAQ,CAACK,SAAS;MAC1Cb,WAAW,CAACW,QAAQ,GAAGA,QAAQ;MAE/BR,QAAQ,CAAC,IAAI,EAAE,IAAI,EAAEK,QAAQ,CAACM,UAAU,CAAC;MACzC;IACF;;IAEA;IACA,IAAIN,QAAQ,CAACK,SAAS,CAAC,CAAC,CAAC,CAACE,EAAE,KAAK,CAAC,EAAE;MAClC,OAAOZ,QAAQ,CAAC,IAAId,UAAU,CAACmB,QAAQ,CAACK,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;IACxD;;IAEA;IACA,MAAMF,QAAQ,GACZ,OAAOH,QAAQ,CAACK,SAAS,CAAC,CAAC,CAAC,CAACG,MAAM,CAACC,EAAE,KAAK,QAAQ,GAC/CzB,IAAI,CAACoB,UAAU,CAACJ,QAAQ,CAACK,SAAS,CAAC,CAAC,CAAC,CAACG,MAAM,CAACC,EAAE,CAAC,GAChDT,QAAQ,CAACK,SAAS,CAAC,CAAC,CAAC,CAACG,MAAM,CAACC,EAAE;IAErCjB,WAAW,CAACa,SAAS,GAAGL,QAAQ,CAACK,SAAS,CAAC,CAAC,CAAC,CAACG,MAAM,CAACE,SAAS;IAC9DlB,WAAW,CAACW,QAAQ,GAAGA,QAAQ;IAE/BR,QAAQ,CAAC,IAAI,EAAEK,QAAQ,CAACK,SAAS,CAAC,CAAC,CAAC,EAAEL,QAAQ,CAACM,UAAU,CAAC;EAC5D;EAEA,IAAIV,WAAW,GAAG,CAAC,EAAE;IACnB,MAAMe,IAAI,GAAGrB,MAAM,CAACsB,CAAC,CAACD,IAAI;IAC1B,MAAME,SAAS,GAAG,IAAInC,OAAO,CAACiC,IAAI,EAAEpB,EAAE,EAAEC,WAAW,CAACW,QAAQ,EAAE;MAAEW,cAAc,EAAErB;IAAU,CAAC,CAAC;IAC5F,MAAMsB,YAAY,GAAG5B,uBAAuB,CAAC,CAAC,CAAC,EAAEK,WAAW,CAAC;IAC7DF,MAAM,CAACsB,CAAC,CAACI,IAAI,CAACC,KAAK,CAACJ,SAAS,EAAEE,YAAY,EAAElB,aAAa,CAAC;IAC3D;EACF;EAEA,MAAMM,QAAQ,GACZX,WAAW,CAACW,QAAQ,YAAYnB,IAAI,GAChCQ,WAAW,CAACW,QAAQ,GACpBnB,IAAI,CAACoB,UAAU,CAACZ,WAAW,CAACW,QAAQ,CAAC;EAE3C,MAAMe,UAAU,GAAG;IACjB7B,OAAO,EAAEc,QAAQ;IACjBgB,UAAU,EAAElC,mBAAmB,CAACM,EAAE,CAAC;IACnCE,SAAS,EAAE2B,IAAI,CAACC,GAAG,CAAC5B,SAAS;EAC/B,CAAC;EAED,IAAID,WAAW,CAAC8B,GAAG,CAACC,QAAQ,IAAI,OAAO/B,WAAW,CAAC8B,GAAG,CAACE,cAAc,KAAK,QAAQ,EAAE;IAClFN,UAAU,CAACO,SAAS,GAAGjC,WAAW,CAAC8B,GAAG,CAACE,cAAc;EACvD;EAEA,MAAME,cAAc,GAAGC,MAAM,CAACC,MAAM,CAClC;IACEC,mBAAmB,EAAE,IAAI;IACzBC,mBAAmB,EAAE;EACvB,CAAC,EACDpC,OAAO,CACR;EAED,IAAIF,WAAW,CAACuC,OAAO,EAAE;IACvBL,cAAc,CAACK,OAAO,GAAGvC,WAAW,CAACuC,OAAO;EAC9C;EAEA3C,OAAO,CAACE,MAAM,EAAEC,EAAE,EAAE2B,UAAU,EAAEQ,cAAc,EAAE7B,aAAa,CAAC;AAChE;AAEAmC,MAAM,CAACC,OAAO,GAAG5C,OAAO"},"metadata":{},"sourceType":"script"}